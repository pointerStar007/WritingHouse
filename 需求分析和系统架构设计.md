# WritingHouse 网络小说创作平台 - 需求分析和系统架构设计

## 1. 项目概述

**项目名称**: WritingHouse  
**项目类型**: B/S架构的网络小说创作平台  
**目标用户**: 网络小说创作者  
**核心价值**: 提供沉浸式的写作工具，提升创作效率

## 2. 功能需求分析

### 2.1 核心功能模块

#### 2.1.1 写作统计模块
- **功能描述**: 记录和统计作者的码字数量
- **统计维度**: 日/月/年三个周期
- **数据指标**: 
  - 每日码字数
  - 月度码字统计
  - 年度码字统计
  - 写作时长统计
  - 创作效率分析

#### 2.1.2 作品管理模块
- **功能描述**: 创建和管理小说作品或笔记
- **核心功能**:
  - 作品创建、编辑、删除
  - 作品分类管理
  - 作品基本信息管理（标题、简介、标签等）
  - 作品状态管理（连载中、已完结、暂停等）

#### 2.1.3 卷管理模块
- **功能描述**: 管理作品的卷结构，便于写作规划
- **核心功能**:
  - 卷的创建、编辑、删除
  - 卷的排序和重组
  - 卷的基本信息管理
  - 卷内章节管理

#### 2.1.4 章节编辑模块
- **功能描述**: 类似Markdown的章节编辑器
- **核心功能**:
  - 富文本编辑器
  - Markdown语法支持
  - 实时预览
  - 自动保存
  - 版本历史
  - 字数统计

#### 2.1.5 作品预览和导出功能
- **功能描述**: 预览和导出作品
- **核心功能**:
  - 阅读器样式预览
  - 一键导出为Word文档
  - 支持多种导出格式
  - 自定义导出样式

## 3. 技术架构设计

### 3.1 技术栈

#### 3.1.1 前端技术栈
- **框架**: Vue 3
- **构建工具**: Vite
- **UI框架**: Element Plus
- **状态管理**: Pinia
- **路由**: Vue Router
- **HTTP客户端**: Axios
- **编辑器**: Monaco Editor / Quill

#### 3.1.2 后端技术栈
- **框架**: FastAPI
- **数据库**: MySQL 8.0
- **ORM**: SQLAlchemy
- **认证**: JWT
- **文档导出**: python-docx
- **数据验证**: Pydantic

#### 3.1.3 数据库
- **数据库**: MySQL 8.0
- **连接信息**: 
  - 用户名: root
  - 密码: 123456
  - 主机: localhost
  - 端口: 3306

### 3.2 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端 (Vue)    │────│  后端 (FastAPI) │────│  数据库 (MySQL) │
│                 │    │                 │    │                 │
│ - 用户界面      │    │ - REST API      │    │ - 数据存储      │
│ - 状态管理      │    │ - 业务逻辑      │    │ - 数据关系      │
│ - 路由管理      │    │ - 数据验证      │    │ - 索引优化      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 3.3 项目结构设计

```
WritingHouse/
├── frontend/                 # 前端项目
│   ├── src/
│   │   ├── components/       # 公共组件
│   │   ├── views/           # 页面组件
│   │   ├── stores/          # 状态管理
│   │   ├── router/          # 路由配置
│   │   ├── api/             # API接口
│   │   ├── utils/           # 工具函数
│   │   └── styles/          # 样式文件
│   ├── package.json
│   └── vite.config.ts
├── backend/                  # 后端项目
│   ├── app/
│   │   ├── api/             # API路由
│   │   ├── core/            # 核心配置
│   │   ├── db/              # 数据库配置
│   │   ├── models/          # 数据模型
│   │   ├── schemas/         # 数据验证
│   │   └── services/        # 业务逻辑
│   ├── requirements.txt
│   └── main.py
└── README.md
```

## 4. 数据库设计

### 4.1 核心数据表

#### 4.1.1 用户表 (users)
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    nickname VARCHAR(50),
    avatar VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 4.1.2 作品表 (works)
```sql
CREATE TABLE works (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    cover_image VARCHAR(255),
    status ENUM('draft', 'publishing', 'completed', 'paused') DEFAULT 'draft',
    word_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 4.1.3 卷表 (volumes)
```sql
CREATE TABLE volumes (
    id INT PRIMARY KEY AUTO_INCREMENT,
    work_id INT NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    sort_order INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (work_id) REFERENCES works(id) ON DELETE CASCADE
);
```

#### 4.1.4 章节表 (chapters)
```sql
CREATE TABLE chapters (
    id INT PRIMARY KEY AUTO_INCREMENT,
    volume_id INT NOT NULL,
    title VARCHAR(200) NOT NULL,
    content LONGTEXT,
    word_count INT DEFAULT 0,
    sort_order INT DEFAULT 0,
    status ENUM('draft', 'published') DEFAULT 'draft',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (volume_id) REFERENCES volumes(id) ON DELETE CASCADE
);
```

#### 4.1.5 写作统计表 (writing_statistics)
```sql
CREATE TABLE writing_statistics (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    date DATE NOT NULL,
    word_count INT DEFAULT 0,
    writing_time INT DEFAULT 0, -- 写作时长（分钟）
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY unique_user_date (user_id, date)
);
```

### 4.2 索引设计

```sql
-- 用户表索引
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);

-- 作品表索引
CREATE INDEX idx_works_user_id ON works(user_id);
CREATE INDEX idx_works_status ON works(status);
CREATE INDEX idx_works_created_at ON works(created_at);

-- 卷表索引
CREATE INDEX idx_volumes_work_id ON volumes(work_id);
CREATE INDEX idx_volumes_sort_order ON volumes(sort_order);

-- 章节表索引
CREATE INDEX idx_chapters_volume_id ON chapters(volume_id);
CREATE INDEX idx_chapters_sort_order ON chapters(sort_order);
CREATE INDEX idx_chapters_status ON chapters(status);

-- 写作统计表索引
CREATE INDEX idx_writing_statistics_user_date ON writing_statistics(user_id, date);
CREATE INDEX idx_writing_statistics_date ON writing_statistics(date);
```

## 5. API设计

### 5.1 认证相关API
- `POST /api/v1/auth/login` - 用户登录
- `POST /api/v1/auth/register` - 用户注册
- `POST /api/v1/auth/logout` - 用户登出
- `POST /api/v1/auth/refresh` - 刷新token

### 5.2 作品管理API
- `GET /api/v1/works` - 获取作品列表
- `POST /api/v1/works` - 创建作品
- `GET /api/v1/works/{id}` - 获取作品详情
- `PUT /api/v1/works/{id}` - 更新作品
- `DELETE /api/v1/works/{id}` - 删除作品

### 5.3 章节管理API
- `GET /api/v1/chapters` - 获取章节列表
- `POST /api/v1/chapters` - 创建章节
- `GET /api/v1/chapters/{id}` - 获取章节详情
- `PUT /api/v1/chapters/{id}` - 更新章节
- `DELETE /api/v1/chapters/{id}` - 删除章节

### 5.4 统计相关API
- `GET /api/v1/statistics/daily` - 获取日统计
- `GET /api/v1/statistics/monthly` - 获取月统计
- `GET /api/v1/statistics/yearly` - 获取年统计

## 6. 部署方案

### 6.1 开发环境
- 前端: `npm run dev` (端口: 5173)
- 后端: `uvicorn main:app --reload` (端口: 8000)
- 数据库: MySQL 8.0 (端口: 3306)

### 6.2 生产环境
- 前端: Nginx + 静态文件
- 后端: Gunicorn + FastAPI
- 数据库: MySQL 8.0
- 反向代理: Nginx

## 7. 性能优化

### 7.1 前端优化
- 代码分割和懒加载
- 静态资源压缩
- CDN加速
- 缓存策略

### 7.2 后端优化
- 数据库连接池
- Redis缓存
- API响应压缩
- 异步处理

### 7.3 数据库优化
- 索引优化
- 查询优化
- 分页查询
- 读写分离

## 8. 安全考虑

### 8.1 认证安全
- JWT token认证
- 密码加密存储
- 登录失败限制
- Session管理

### 8.2 数据安全
- SQL注入防护
- XSS攻击防护
- CSRF攻击防护
- 数据验证和过滤

### 8.3 传输安全
- HTTPS加密
- API接口鉴权
- 敏感数据加密
- 日志安全

---

**文档版本**: v2.0  
**最后更新**: 2024年1月  
**维护者**: WritingHouse开发团队